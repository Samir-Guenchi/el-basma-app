openapi: 3.0.3
info:
  title: Boutique Manager API
  description: API for Women's Boutique Management App
  version: 1.0.0
  contact:
    email: api@boutique.example.com

servers:
  - url: https://api.boutique.example.com/v1
    description: Production server
  - url: https://staging-api.boutique.example.com/v1
    description: Staging server

tags:
  - name: Auth
    description: Authentication endpoints
  - name: Products
    description: Product management
  - name: Orders
    description: Order management
  - name: Categories
    description: Category management
  - name: Tags
    description: Tag management

paths:
  # ============================================
  # AUTH ENDPOINTS
  # ============================================
  /auth/login:
    post:
      tags: [Auth]
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 6
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/register:
    post:
      tags: [Auth]
      summary: User registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, name]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 6
                name:
                  type: string
                role:
                  $ref: '#/components/schemas/UserRole'
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tokens:
                        $ref: '#/components/schemas/AuthTokens'

  /auth/logout:
    post:
      tags: [Auth]
      summary: User logout
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Logout successful

  # ============================================
  # PRODUCT ENDPOINTS
  # ============================================
  /products:
    get:
      tags: [Products]
      summary: Get all products
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: array
            items:
              type: string
        - name: availabilityStatus
          in: query
          schema:
            $ref: '#/components/schemas/AvailabilityStatus'
        - name: minPrice
          in: query
          schema:
            type: number
        - name: maxPrice
          in: query
          schema:
            type: number
        - name: search
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Products list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedProducts'

    post:
      tags: [Products]
      summary: Create a product
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '201':
          description: Product created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '403':
          $ref: '#/components/responses/Forbidden'

  /products/{id}:
    get:
      tags: [Products]
      summary: Get product by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags: [Products]
      summary: Update product
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'

    delete:
      tags: [Products]
      summary: Delete product
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Product deleted
        '403':
          $ref: '#/components/responses/Forbidden'

  /products/{id}/stock:
    put:
      tags: [Products]
      summary: Update product stock by date
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                stockByDate:
                  type: array
                  items:
                    $ref: '#/components/schemas/StockByDate'
      responses:
        '200':
          description: Stock updated

  /products/{id}/availability:
    get:
      tags: [Products]
      summary: Get product availability for date range
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: startDate
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Availability data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/StockByDate'

  /products/stock/bulk:
    post:
      tags: [Products]
      summary: Bulk upload stock data (CSV)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                entries:
                  type: array
                  items:
                    type: object
                    properties:
                      sku:
                        type: string
                      date:
                        type: string
                        format: date
                      quantity:
                        type: integer
      responses:
        '200':
          description: Bulk upload result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkUploadResult'

  # ============================================
  # ORDER ENDPOINTS
  # ============================================
  /orders:
    get:
      tags: [Orders]
      summary: Get all orders
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/OrderStatus'
        - name: page
          in: query
          schema:
            type: integer
        - name: limit
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Orders list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedOrders'

    post:
      tags: [Orders]
      summary: Create order request
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

  /orders/{id}:
    get:
      tags: [Orders]
      summary: Get order by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

  /orders/{id}/status:
    patch:
      tags: [Orders]
      summary: Update order status
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  $ref: '#/components/schemas/OrderStatus'
      responses:
        '200':
          description: Status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

  # ============================================
  # CATEGORY & TAG ENDPOINTS
  # ============================================
  /categories:
    get:
      tags: [Categories]
      summary: Get all categories
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Categories list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Category'

    post:
      tags: [Categories]
      summary: Create category
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryInput'
      responses:
        '201':
          description: Category created

  /tags:
    get:
      tags: [Tags]
      summary: Get all tags
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Tags list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Tag'

    post:
      tags: [Tags]
      summary: Create tag
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TagInput'
      responses:
        '201':
          description: Tag created

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    TranslatedText:
      type: object
      properties:
        en:
          type: string
        fr:
          type: string
        ar:
          type: string
        dz:
          type: string

    UserRole:
      type: string
      enum: [owner, staff, customer]

    AvailabilityStatus:
      type: string
      enum: [in-stock, limited, out-of-stock]

    OrderStatus:
      type: string
      enum: [pending, confirmed, processing, completed, cancelled]

    StockByDate:
      type: object
      properties:
        date:
          type: string
          format: date
        quantity:
          type: integer

    AuthTokens:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        expiresAt:
          type: integer

    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        name:
          type: string
        role:
          $ref: '#/components/schemas/UserRole'
        phone:
          type: string
        avatar:
          type: string
        preferredLocale:
          type: string
          enum: [en, fr, ar, dz]
        createdAt:
          type: string
          format: date-time

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            tokens:
              $ref: '#/components/schemas/AuthTokens'

    Product:
      type: object
      properties:
        id:
          type: string
        name:
          $ref: '#/components/schemas/TranslatedText'
        description:
          $ref: '#/components/schemas/TranslatedText'
        images:
          type: array
          items:
            type: string
        category:
          type: string
        price:
          type: number
        currency:
          type: string
        sku:
          type: string
        stockByDate:
          type: array
          items:
            $ref: '#/components/schemas/StockByDate'
        availabilityStatus:
          $ref: '#/components/schemas/AvailabilityStatus'
        tags:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ProductInput:
      type: object
      required: [name, description, category, price, sku]
      properties:
        name:
          $ref: '#/components/schemas/TranslatedText'
        description:
          $ref: '#/components/schemas/TranslatedText'
        images:
          type: array
          items:
            type: string
        category:
          type: string
        price:
          type: number
        currency:
          type: string
        sku:
          type: string
        stockByDate:
          type: array
          items:
            $ref: '#/components/schemas/StockByDate'
        availabilityStatus:
          $ref: '#/components/schemas/AvailabilityStatus'
        tags:
          type: array
          items:
            type: string

    ProductResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Product'

    PaginatedProducts:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Product'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Order:
      type: object
      properties:
        id:
          type: string
        customerId:
          type: string
        customerName:
          type: string
        customerPhone:
          type: string
        items:
          type: array
          items:
            type: object
            properties:
              productId:
                type: string
              productName:
                $ref: '#/components/schemas/TranslatedText'
              quantity:
                type: integer
              price:
                type: number
              requestedDate:
                type: string
                format: date
        status:
          $ref: '#/components/schemas/OrderStatus'
        totalAmount:
          type: number
        currency:
          type: string
        notes:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    OrderInput:
      type: object
      required: [customerName, customerPhone, items]
      properties:
        customerName:
          type: string
        customerPhone:
          type: string
        items:
          type: array
          items:
            type: object
            properties:
              productId:
                type: string
              quantity:
                type: integer
              requestedDate:
                type: string
                format: date
        notes:
          type: string

    OrderResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Order'

    PaginatedOrders:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Order'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Category:
      type: object
      properties:
        id:
          type: string
        name:
          $ref: '#/components/schemas/TranslatedText'
        slug:
          type: string
        parentId:
          type: string
        image:
          type: string

    CategoryInput:
      type: object
      required: [name, slug]
      properties:
        name:
          $ref: '#/components/schemas/TranslatedText'
        slug:
          type: string
        parentId:
          type: string
        image:
          type: string

    Tag:
      type: object
      properties:
        id:
          type: string
        name:
          $ref: '#/components/schemas/TranslatedText'
        slug:
          type: string

    TagInput:
      type: object
      required: [name, slug]
      properties:
        name:
          $ref: '#/components/schemas/TranslatedText'
        slug:
          type: string

    BulkUploadResult:
      type: object
      properties:
        success:
          type: integer
        failed:
          type: integer
        errors:
          type: array
          items:
            type: object
            properties:
              row:
                type: integer
              sku:
                type: string
              error:
                type: string

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  details:
                    type: object

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: UNAUTHORIZED
                  message:
                    type: string

    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: FORBIDDEN
                  message:
                    type: string

    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: NOT_FOUND
                  message:
                    type: string
